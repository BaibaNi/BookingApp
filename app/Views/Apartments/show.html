{% extends "layout.html" %}

{% block content %}

<div>
    <p>
        <a href="/apartments">Back</a>
        {% if session.userid is defined %}
            | <a href="/apartments/create">Add apartment for booking</a>
        {% endif %}
    </p>
</div>

<div class="container">
    <div class="row">

        <div class="col">
            <div class="card" style="width: 280px;">
                <img src="https://imagesvc.meredithcorp.io/v3/mm/image?url=https%3A%2F%2Fstatic.onecms.io%2Fwp-content%2Fuploads%2Fsites%2F24%2F2020%2F06%2F02%2Fbeachside-bungalow-plan-sl-1117_0-2000.jpg&w=400&h=268&c=sc&poi=face&q=60"
                     class="card-img-top" alt="house" style="width: 265px; margin: 1% auto">
                <div class="card-body">
                    <div>
                        <h5 class="card-title">{{ apartment.title }} ({{ avgRating }} â˜…)</h5>
                    </div>
                    <div class="card-text">
                        <p class="description">Address: {{ apartment.address }}</p>
                        <p class="description">Description: {{ apartment.description }}</p>
                        <p class="description">Available from: {{ apartment.availableFrom|date('d-m-Y') }}</p>
                        <p class="description">Available until: {{ apartment.availableUntil|date('d-m-Y') }}</p>
                    </div>
                    {% if session.userid == apartment.userId %}
                    <form method="post" action="/apartments/{{ apartment.id }}/delete">
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this item?')" class="btn btn-primary">Delete</button>
                    </form>
                    <p>
                        <a href="/apartments/{{ apartment.id }}/edit">Edit</a>
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>

        {% if session.userid is defined %}
        <div class="col">
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                    <h5 class="card-title">SELECT THE RESERVATION PERIOD:</h5>
                    <div class="card-text">
                        <form method="post" action="/apartments/{{ apartment.id }}/reserve">
                            <div>
                                <label for="available_from" class="form-label">From:</label>
                                <input type="date" id="available_from" name="available_from" class="form-control"/>
                                {% if errors.available_from %}
                                <p class="small_error">{{ errors.available_from[0] }}</p>
                                {% endif %}
                            </div>
                            <div>
                                <label for="available_until" class="form-label">Till:</label>
                                <input type="date" id="available_until" name="available_until" class="form-control"/>
                                {% if errors.available_until %}
                                <p class="small_error">{{ errors.available_until[0] }}</p>
                                {% endif %}
                            </div>

                            <button type="submit" class="btn btn-primary">Reserve</button>
                        </form>
                    </div>
                </div>

            </div>
        </div>
        {% endif %}


        {% if session.userid is defined %}
        <div class="col">
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                <h5 class="card-title">REVIEW AND RATE:</h5>
                    <div class="card-text">
                        <form method="post" action="/apartments/{{ apartment.id }}/review">
                            <div>
                                <label for="review" class="form-label">Leave a review:</label>
                                <textarea id="review" name="review" class="form-control">{{ inputs.review }}</textarea>
                                {% if errors.review %}
                                    <p class="small_error">{{ errors.review[0] }}</p>
                                {% endif %}
                            </div>

                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="rating" id="rating1" value="5">
                                    <label class="form-check-label" for="rating1">
                                        5 - Excellent
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="rating" id="rating2" value="4">
                                    <label class="form-check-label" for="rating2">
                                        4 - Very good
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="rating" id="rating3" value="3">
                                    <label class="form-check-label" for="rating3">
                                        3 - Good
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="rating" id="rating4" value="2">
                                    <label class="form-check-label" for="rating4">
                                        2 - Bad
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="rating" id="rating5" value="1">
                                    <label class="form-check-label" for="rating5">
                                        1 - Vary bad
                                    </label>
                                </div>
                                {% if errors.rating %}
                                <p class="small_error">{{ errors.rating[0] }}</p>
                                {% endif %}
                            </div>
                            <div>
                                <button type="submit" class="btn btn-primary">Add review</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

    </div>
</div>

{% if session.userid is defined %}
<br>
    <h5>All reviews:</h5>
    {% if reviews is not empty %}

        {% for review in reviews %}
        <div class="card">
            <div class="card-body">
                <p>{{ review.review }}</p>
                <p class="description">{{ review.name }} {{ review.surname }} | Posted on: {{ review.createdAt|date('d-m-Y')}}</p>
            </div>
        </div>
        {% endfor %}

    {% else %}
        <div class="card">
            <div class="card-body">
                <p>There are no reviews yet.</p>
            </div>
        </div>
    {% endif %}
{% endif %}



{% endblock %}